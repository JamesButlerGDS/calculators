<% content_for :title, "Estimate your High Income Child Benefit Tax Charge" %>
<% content_for :wrapper_classes, "answer full-width" %>

<section id="content" role="main" class="group calculator-page">
  <header class="page-header group full-width">
    <hgroup class="full-width">
    <h1><span>Quick answer</span> Estimate your High Income Child Benefit Tax Charge for <%= @calculator.tax_year %> to <%= @calculator.tax_year + 1 %></h1>
    </hgroup>
    <a class="skip-to-related" href="#related">Not what you're looking for? ↓</a>
  </header>

  <section class="thirds" id="calculator">
    <div class="calculator-questions">
      <%= form_tag("main") do %>
        <!-- hidden field to store the tax year so it can persist -->
        <input type="hidden" name="year" value="<%= params[:year] %>" />

        <fieldset>
          <%= step(1, "Adjusted net income") %>
          <%= money_input("Adjusted Net Income", "adjusted_net_income") %>

          <p>If you don't know your adjusted net income, you can fill out the five fields below:</p>
          <%= money_input("Total annual income before tax", "total_annual_income") %>
          <%= money_input("Gross pension contributions", "gross_pension_contributons") %>
          <%= money_input("Net pension contributions", "net_pension_contributions") %>
          <%= money_input("Trading losses if you're self-employed", "trading_losses_self_employed") %>
          <%= money_input("Gift Aid donations", "gift_aid_donations") %>
        </fieldset>

        <fieldset>
          <%= step(2, "Number of children you're claiming for") %>
          <%= money_input("How many children will you or your partner be getting paid Child Benefit for from #{@calculator.tax_year}?", "children_count") %>
        </fieldset>

        <fieldset id="add_new_starting_child">
          <%= step(3, "Are you planning on claiming for any new children this year?") %>
          <%= render "partials/child_benefit_tax/starting_children" %>
        </fieldset>

        <fieldset id="add_new_stopping_child">
          <%= step(4, "Are you claiming for any children who will become ineligible this year?") %>
          <%= render "partials/child_benefit_tax/stopping_children" %>
        </fieldset>

        <%= submit_tag("Go", { :class => "button" }) %>
      <% end %>
    </div>
    <div class="outcome">
      <div class="results-box">
        <h2>Results</h2>
        <p><span class="total-owed"><%= number_to_currency @calculator.amount_owed, unit: "£", precision: 2 %></span></p>
        <ul>
          <li>the person with the highest income will have to pay back</li>
          <li>this is an estimate based on the figures you have provided</li>
        </ul>
      </div>
      <div class="results-text">
        <h3>Paying back Child Benefit as tax</h3>
        <ul>
          <li>carry on getting benefit and pay <span class="total-owed"><%= number_to_currency @calculator.amount_owed, unit: "£", precision: 2 %></span> back at the end of the year through Self Assessment</li>
          <li>stop getting Child Benefit from now, and pay back any tax you owe from 2013-14 in next year's Self Assessment tax return</li>
        </ul>
      </div>
    </div>
  </section><!-- end .thirds -->
</section>
